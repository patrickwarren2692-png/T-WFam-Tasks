<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>T-WFam Private</title>
    <link rel="manifest" href="/manifest.json">
    <style>
        :root { --primary: #6366f1; --success: #22c55e; --danger: #ef4444; --bg: #f8fafc; --text: #1e293b; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; padding-bottom: 120px; }
        
        /* Privacy Gate Styles */
        #authGate { position: fixed; inset: 0; background: var(--primary); z-index: 2000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; color: white; }
        .gate-input { padding: 15px; border-radius: 10px; border: none; width: 80%; margin: 15px 0; font-size: 1.2rem; text-align: center; }

        /* App Styles */
        .card { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .progress-bar { background: #e2e8f0; height: 10px; border-radius: 5px; overflow: hidden; margin: 10px 0; }
        #progressFill { background: var(--success); height: 100%; width: 0%; transition: 0.5s; }
        .day-section { margin-top: 20px; border-left: 4px solid var(--primary); padding-left: 10px; }
        .task { background: #f1f5f9; padding: 10px; border-radius: 10px; margin: 8px 0; display: flex; align-items: center; justify-content: space-between; }
        .task.done { opacity: 0.5; background: #dcfce7; text-decoration: line-through; }
        
        /* Settings Overlay */
        #settings { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1500; padding: 30px; color: white; }
        button { border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-main { background: var(--primary); color: white; padding: 15px; width: 100%; }
    </style>
</head>
<body>

    <div id="authGate">
        <h1>T-WFam Tasks</h1>
        <p>Please enter the Family Password to continue</p>
        <input type="password" id="familyPass" class="gate-input" placeholder="Password...">
        <button onclick="checkAuth()" class="btn-main" style="background: white; color: var(--primary);">Unlock App</button>
    </div>

    <div id="appContent" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 style="margin:0;">Family Dashboard</h2>
            <button onclick="document.getElementById('settings').style.display='block'" style="background:#cbd5e1; padding:8px;">‚öôÔ∏è</button>
        </div>

        <div class="card" style="margin-top:15px;">
            <div style="display:flex; justify-content:space-between;"><span>Weekly Progress</span><span id="pct">0%</span></div>
            <div class="progress-bar"><div id="progressFill"></div></div>
        </div>

        <div class="card">
            <select id="jS" style="width:100%; padding:10px; margin-bottom:10px;">
                <option value="Vacuuming">Vacuuming</option>
                <option value="Dishes">Dishes</option>
                <option value="Laundry">Laundry</option>
                <option value="Bathroom">Bathroom</option>
            </select>
            <div style="display:flex; gap:10px;">
                <select id="nS" style="flex:1; padding:10px;">
                    <option value="Patrick">Patrick</option>
                    <option value="Partner">Partner</option>
                </select>
                <select id="dS" style="flex:1; padding:10px;">
                    <option value="Monday">Mon</option><option value="Tuesday">Tue</option>
                    <option value="Wednesday">Wed</option><option value="Thursday">Thu</option>
                    <option value="Friday">Fri</option><option value="Saturday">Sat</option>
                    <option value="Sunday">Sun</option>
                </select>
            </div>
            <button onclick="addTask()" class="btn-main" style="margin-top:10px;">‚ûï Add Task</button>
        </div>

        <div id="taskDisplay"></div>
    </div>

    <div id="settings">
        <h2>Settings</h2>
        <button onclick="resetWeek()" style="background:var(--danger); padding:15px; width:100%; margin-bottom:10px;">üö® Reset Week</button>
        <button onclick="logout()" style="background:#475569; padding:15px; width:100%; margin-bottom:10px;">üîí Logout</button>
        <button onclick="document.getElementById('settings').style.display='none'" style="background:white; color:black; padding:10px; width:100%;">Close</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyDQOz-r2LIjk2Eyw19sy7yjzvhxafUFzKI",
            databaseURL: "https://family-clean-d428e-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "family-clean-d428e",
            messagingSenderId: "1067832584063",
            appId: "1:1067832584063:web:4f2c12e7374ccfeea75c4a"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tasksRef = db.ref('tasks');
        const MASTER_PASS = "1234"; // CHANGE THIS TO YOUR SHARED PASSWORD

        // AUTH LOGIC
        function checkAuth() {
            if(document.getElementById('familyPass').value === MASTER_PASS) {
                localStorage.setItem('familyAuth', 'true');
                showApp();
            } else { alert("Wrong password!"); }
        }

        function showApp() {
            if(localStorage.getItem('familyAuth') === 'true') {
                document.getElementById('authGate').style.display = 'none';
                document.getElementById('appContent').style.display = 'block';
                initSync();
            }
        }

        function logout() {
            localStorage.removeItem('familyAuth');
            location.reload();
        }

        // TASK LOGIC
        let tasks = [];
        function initSync() {
            tasksRef.on('value', snap => {
                const data = snap.val();
                tasks = [];
                for(let id in data) tasks.push({id, ...data[id]});
                render();
            });
        }

        function addTask() {
            tasksRef.push({
                job: document.getElementById('jS').value,
                person: document.getElementById('nS').value,
                day: document.getElementById('dS').value,
                completed: false
            });
        }

        function toggle(id, status) { db.ref('tasks/'+id).update({completed: !status}); }
        function resetWeek() { if(confirm("Clear all?")) tasksRef.remove(); }

        function render() {
            const container = document.getElementById('taskDisplay');
            container.innerHTML = '';
            const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
            
            let total = tasks.length, done = tasks.filter(t=>t.completed).length;
            let p = total > 0 ? Math.round((done/total)*100) : 0;
            document.getElementById('progressFill').style.width = p+'%';
            document.getElementById('pct').innerText = p+'%';

            days.forEach(day => {
                const dTasks = tasks.filter(t => t.day === day);
                if(dTasks.length === 0) return;
                let html = `<div class="day-section"><strong>${day}</strong>`;
                dTasks.forEach(t => {
                    html += `
                    <div class="task ${t.completed?'done':''}" onclick="toggle('${t.id}', ${t.completed})">
                        <div><b>${t.person}</b>: ${t.job}</div>
                        <div>${t.completed?'‚úÖ':'‚≠ï'}</div>
                    </div>`;
                });
                container.innerHTML += html + `</div>`;
            });
        }

        showApp(); // Check auth on load
    </script>
</body>
</html>

