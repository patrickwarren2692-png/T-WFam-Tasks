<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T-WFam Tasks</title>
    
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f172a">
    <link rel="icon" sizes="192x192" href="https://img.icons8.com/fluency/192/home.png">
    <link rel="apple-touch-icon" href="https://img.icons8.com/fluency/180/home.png">

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-messaging-compat.js"></script>

    <style>
        :root { --primary: #6366f1; --success: #10b981; --danger: #ef4444; --glass: rgba(255, 255, 255, 0.85); }
        body { font-family: 'Inter', sans-serif; background: radial-gradient(at 0% 0%, hsla(253,16%,7%,1) 0, transparent 50%), radial-gradient(at 100% 0%, hsla(339,49%,30%,1) 0, transparent 50%); background-color: #0f172a; background-attachment: fixed; min-height: 100vh; padding: 10px; margin: 0; color: white; }
        .container { max-width: 1200px; margin: 0 auto; }
        .stats-panel { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 20px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .progress-label { display: flex; justify-content: space-between; font-weight: 800; font-size: 0.8rem; margin-bottom: 8px; }
        .progress-container { width: 100%; background: rgba(255,255,255,0.1); border-radius: 20px; height: 10px; overflow: hidden; }
        #progressBar { width: 0%; height: 100%; background: var(--success); transition: width 0.6s ease; }
        .tools-bar { display: flex; flex-direction: column; gap: 10px; margin-bottom: 15px; }
        .filter-group { display: flex; gap: 5px; flex-wrap: wrap; justify-content: center; }
        .chip { padding: 6px 10px; border-radius: 20px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); cursor: pointer; font-size: 0.75rem; font-weight: 600; color: white; transition: 0.2s; }
        .chip.active { background: var(--primary); border-color: var(--primary); box-shadow: 0 0 10px var(--primary); }
        .glass-panel { background: var(--glass); backdrop-filter: blur(15px); padding: 15px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.2); margin-bottom: 15px; color: #1e293b; }
        #mainDisplay { width: 100%; display: grid; gap: 12px; grid-template-columns: 1fr; }
        @media (min-width: 600px) { #mainDisplay { grid-template-columns: repeat(2, 1fr); } }
        .day-card { background: rgba(255,255,255,0.1); padding: 12px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); height: fit-content; }
        .task-item { background: white; color: #1e293b; padding: 10px; border-radius: 12px; margin-bottom: 8px; }
        button { background: var(--primary); color: white; border: none; font-weight: 700; cursor: pointer; padding: 10px; border-radius: 10px; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1000; backdrop-filter: blur(10px); }
        .modal { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; color: #1e293b; padding: 20px; border-radius: 20px; width: 85%; max-width: 400px; }
    </style>
</head>
<body>

<div class="container">
    <h1 style="text-align: center; font-size: 1.5rem; margin: 10px 0;">T-WFam Tasks</h1>
    <div class="stats-panel">
        <div class="progress-label"><span>Progress</span><span id="percentLabel">0%</span></div>
        <div class="progress-container"><div id="progressBar"></div></div>
    </div>

    <div class="tools-bar">
        <div class="filter-group" id="personFilters">
            <div class="chip active" onclick="setPersonFilter('All', this)">Family</div>
            <div class="chip" onclick="setPersonFilter('Hayden', this)">Hayden</div>
            <div class="chip" onclick="setPersonFilter('Jordan', this)">Jordan</div>
            <div class="chip" onclick="setPersonFilter('Mum', this)">Mum</div>
            <div class="chip" onclick="setPersonFilter('Dad', this)">Dad</div>
        </div>
        <div class="filter-group">
            <div class="chip" onclick="requestNotificationPermission()" style="background:var(--success)">üîî Enable Notifications</div>
            <div class="chip" onclick="openSettings()">‚öôÔ∏è Settings</div>
        </div>
    </div>

    <div class="glass-panel">
        <select id="jobSelect" style="width:48%"></select>
        <select id="nameSelect" style="width:48%"><option>Hayden</option><option>Jordan</option><option>Mum</option><option>Dad</option></select>
        <button onclick="addTask()" style="width:100%; margin-top:10px;">Assign Task</button>
    </div>

    <div id="mainDisplay"></div>
</div>

<div id="settingsOverlay" class="overlay">
    <div class="modal">
        <h3>Library Management</h3>
        <input type="text" id="libJob" placeholder="Job Name" style="width:100%; margin-bottom:10px;">
        <button onclick="saveToLibrary()" style="width:100%; margin-bottom:10px;">Save to Library</button>
        <button onclick="closeSettings()" style="width:100%; background:#64748b;">Close</button>
    </div>
</div>

<script>
    const firebaseConfig = {
      apiKey: "AIzaSyDQOz-r2LIjk2Eyw19sy7yjzvhxafUFzKI",
      authDomain: "family-clean-d428e.firebaseapp.com",
      databaseURL: "https://family-clean-d428e-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "family-clean-d428e",
      storageBucket: "family-clean-d428e.firebasestorage.app",
      messagingSenderId: "1067832584063",
      appId: "1:1067832584063:web:4f2c12e7374ccfeea75c4a"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const messaging = firebase.messaging();

    function requestNotificationPermission() {
        Notification.requestPermission().then((permission) => {
            if (permission === 'granted') {
                // FIXED: Using ./ ensures the phone finds the worker file
                navigator.serviceWorker.register('./firebase-messaging-sw.js')
                .then((registration) => {
                    messaging.getToken({ 
                        serviceWorkerRegistration: registration,
                        vapidKey: 'BCN2BP-5hhrCwS8O7JyJ-tdkUb3HWgqczNYgWHtJcMfX7L7K6jft3fLQN_B7M1DX4-QqIg_gT7CbAAYO12RWGfk' 
                    })
                    .then((token) => {
                        if (token) {
                            const name = document.getElementById('nameSelect').value;
                            db.ref('tokens/' + name).set(token);
                            alert("Success! Token saved for " + name);
                        }
                    })
                    .catch(err => alert("Token Error: " + err.message));
                });
            }
        });
    }

    // Basic app logic
    db.ref('tasks').on('value', snap => {
        const val = snap.val();
        const display = document.getElementById('mainDisplay');
        display.innerHTML = '';
        if(val) Object.keys(val).forEach(k => {
            const t = val[k];
            display.innerHTML += `<div class="task-item"><b>${t.person}</b>: ${t.job}</div>`;
        });
    });

    function openSettings() { document.getElementById('settingsOverlay').style.display = 'block'; }
    function closeSettings() { document.getElementById('settingsOverlay').style.display = 'none'; }
    function addTask() {
        const job = document.getElementById('jobSelect').value;
        const person = document.getElementById('nameSelect').value;
        db.ref('tasks').push({ job, person, completed: false });
    }
</script>
</body>
</html>
